$(document).ready(function(){function h(a){$("#alertErrorMessage").text(a);$("#alertError").slideDown()}function m(a){$.post(BaseUrl+"calendar/completed",{id:a},function(b){1===1*b?($("#btnDoneEvent").addClass("hide"),$("#btnRestoreEvent").removeClass("hide"),$("#btnRemoveEvent").removeClass("hide"),$("#btnRestoreEvent").off("click.restore-event").on("click.restore-event",function(){bootbox.confirm("\u0421\u043d\u044f\u0442\u044c \u043c\u0435\u0442\u043a\u0443 \u00ab\u0412\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u043e\u00bb \u0434\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u0441\u043e\u0431\u044b\u0442\u0438\u044f?",
function(b){b&&$.post(BaseUrl+"calendar/restore",{id:a},function(a){1===1*a?($("#ShowCalendarEvent").modal("hide"),$("#calendar").fullCalendar("refetchEvents")):console.log(a)},"text")})}),$("#btnRemoveEvent").off("click.remove-event").on("click.remove-event",function(){bootbox.confirm("\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u044d\u0442\u043e \u0441\u043e\u0431\u044b\u0442\u0438\u0435 \u0431\u0435\u0437\u0432\u043e\u0437\u0432\u0440\u0430\u0442\u043d\u043e?",function(b){b&&$.post(BaseUrl+"calendar/remove",
{id:a},function(a){1===1*a?($("#ShowCalendarEvent").modal("hide"),$("#calendar").fullCalendar("refetchEvents")):console.log(a)},"text")})})):($("#btnRestoreEvent").addClass("hide"),$("#btnRemoveEvent").addClass("hide"),$("#btnDoneEvent").removeClass("hide"),$("#btnDoneEvent").off("click.done-event").on("click.done-event",function(){$.AssolCalendar.DoneEvent(a)}))},"text")}function g(){$.post("/calendar/allevents",function(a){""!==a&&$("#AllEventsList").html(a)},"html")}function n(a){$.post("/calendar/checkalluser",
{ID:a},function(b){"y"===b&&($("#btnDoneEvent").addClass("hide"),$("#btnRestoreEvent").addClass("hide"),$("#btnRemoveEvent").removeClass("hide"),$("#btnRemoveEvent").off("click.remove-event").on("click.remove-event",function(){bootbox.confirm("\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u044d\u0442\u043e \u0441\u043e\u0431\u044b\u0442\u0438\u0435 \u0431\u0435\u0437\u0432\u043e\u0437\u0432\u0440\u0430\u0442\u043d\u043e?",function(b){b&&$.post(BaseUrl+"calendar/remove",{id:a},function(a){1===1*a?($("#ShowCalendarEvent").modal("hide"),
$("#calendar").fullCalendar("refetchEvents"),g()):console.log(a)},"text")})}))},"text")}$.AssolCalendar={Init:function(){this.InitActions();this.InitDynamicData();this.InitTemplate();this.InitCalendar()},InitActions:function(){$("#btnAddCalendarEvent").click(this.SaveCalendarEvent);$("#btnShowDayReport").click(this.ShowReportDay);$("#btnSaveDayReport").click(this.SaveReportDay);$("#AllDayCheckbox").click(this.UpdateEventTimeFormat)},InitDynamicData:function(){},InitTemplate:function(){$("#reportTemplate").template("reportTemplate")},
InitCalendar:function(){$("#calendar").fullCalendar({header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},select:function(a,b){$.AssolCalendar.DialogCalendarEvent(a,b)},eventClick:function(a,b,c){a.uid?"customer"==a.utype?(a=window.open(BaseUrl+"customer/"+a.uid+"/profile","_blank"),a.focus()):"employee"==a.utype&&(a=window.open(BaseUrl+"employee/"+a.uid+"/profile","_blank"),a.focus()):$.AssolCalendar.DialogCalendarEvent(a.start,a.end,a.id,a.title,a.description,a.remind,
!0,-1<jQuery.inArray("action-birthday",a.className),a.forall)},selectable:!0,columnFormat:"dddd",eventLimit:!0,slotLabelFormat:"H:mm",events:{url:BaseUrl+"calendar/data",beforeSend:function(){$("#alertError").hide()},success:function(a){a.error&&h("\u041e\u0448\u0438\u0431\u043a\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0441\u043e\u0431\u044b\u0442\u0438\u0439: "+a.message)},error:function(){h("\u041e\u0448\u0438\u0431\u043a\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0441\u043e\u0431\u044b\u0442\u0438\u0439!")}}})},
DoneEvent:function(a){bootbox.confirm("\u041f\u043e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u043c\u0435\u0442\u043a\u0443 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u043e \u0434\u043b\u044f \u0441\u043e\u0431\u044b\u0442\u0438\u044f?",function(b){function c(){$("#ShowCalendarEvent").modal("hide");$("#calendar").fullCalendar("refetchEvents")}b&&$.post(BaseUrl+"calendar/done",{id:a},c,"json")})},SaveCalendarEvent:function(){$("#alertError").hide();var a={id:$("#AddCalendarEventID").val(),title:$("#AddCalendarEventTitle").val(),
remind:$("#Remind").find("input:checked").val(),description:$("#AddCalendarEventDescription").val()};$("#AllDayCheckbox").prop("checked")?(a.start=$("#event-start").data("DateTimePicker").date().format("YYYY-MM-DD")+" 00:00:00",a.end=$("#event-end").data("DateTimePicker").date().format("YYYY-MM-DD")+" 23:59:59"):(a.start=$("#event-start").data("DateTimePicker").date().format("YYYY-MM-DD HH:mm"),a.end=$("#event-end").data("DateTimePicker").date().format("YYYY-MM-DD HH:mm"));$("#ForAllCheckbox").prop("checked")?
a.forall=1:a.forall=0;$.post(BaseUrl+"calendar/save",a,function(a){a.status?($("#AddCalendarEvent").modal("hide"),$("#calendar").fullCalendar("refetchEvents"),g()):alert(a.message)},"json")},ShowReportDay:function(){$("#btnShowDayReport").hide();$("#formDayReport").slideDown("slow",function(){$("#reportItems").html("<tr><td>\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0434\u0430\u043d\u043d\u044b\u0445...</td></tr>");$.getJSON(BaseUrl+"calendar/data",function(a){$("#reportItems").empty();$.tmpl("reportTemplate",
a).appendTo("#reportItems");$("html, body").animate({scrollTop:$("#formDayReport").offset().top},1E3)})})},SaveReportDay:function(){var a={};$("#formDayReport").find("input").each(function(){a[$(this).attr("id-event")]=$(this).val()});$.post(BaseUrl+"calendar/report",{data:a},function(){$("#formDayReport").slideUp("slow",function(){$("#btnShowDayReport").show()})},"json")},DialogCalendarEvent:function(a,b,c,d,e,f,k,h,l){c?b=b||a:b?b.subtract(1,"seconds"):b=a;var g=$.AssolCalendar.IsAllDay(a,b);f=
f||0;k?(k=g?"DD.MM.YYYY":"DD.MM.YYYY HH:mm",$("#ShowCalendarEventLabel").html(d),$("#showTaskDescription").html(e),$("#showEventStart").html(a.format(k)),$("#showEventEnd").html(b.format(k)),$("#showRemind").html($('label[for="Remind_'+f+'"]').html()),$("#showRemind").closest("tr").css("display",0<f?"table-row":"none"),$("#showAllEvent").html(0<l?"\u0414\u0430":"\u041d\u0435\u0442"),$("#btnEditEvent").off("click.edit-event").on("click.edit-event",function(){$("#ShowCalendarEvent").modal("hide");$.AssolCalendar.DialogCalendarEvent(a,
b,c,d,e,f,!1,!1,l)}),m(c),0<1*l&&n(c),$("#ShowCalendarEvent").modal("show").find(".change-task-description-wrap, .save-edit-wrap").css("display",h?"none":"block")):($("#AddCalendarEventID").val(c),$("#AddCalendarEventLabel").html(c?"\u0420\u0415\u0414\u0410\u041a\u0422\u0418\u0420\u041e\u0412\u0410\u041d\u0418\u0415 \u0421\u041e\u0411\u042b\u0422\u0418\u042f":"\u041d\u041e\u0412\u041e\u0415 \u0421\u041e\u0411\u042b\u0422\u0418\u0415"),$("#AddCalendarEventTitle").val(d),$("#AddCalendarEventDescription").val(e),
$("#event-start").data("DateTimePicker").date(a),$("#event-end").data("DateTimePicker").date(b),$("#AllDayCheckbox").prop("checked",g),$("#ForAllCheckbox").prop("checked",0<l?!0:!1),$("#Remind_"+f).click(),$.AssolCalendar.UpdateEventTimeFormat(),$("#AddCalendarEvent").modal("show"))},IsAllDay:function(a,b){var c=$.AssolCalendar.IsStartDay(a),d=$.AssolCalendar.IsEndDay(b)||$.AssolCalendar.IsStartDay(b);return c&&d},IsStartDay:function(a){return!(a.hour()||a.minute()||a.seconds())},IsEndDay:function(a){return 23==
a.hour()&&59==a.minute()&&59==a.seconds()},UpdateEventTimeFormat:function(){var a=$("#AllDayCheckbox").prop("checked")?"DD.MM.YYYY":"DD.MM.YYYY HH:mm",b=$("#event-start").data("DateTimePicker"),c=$("#event-end").data("DateTimePicker");if(!$("#AllDayCheckbox").prop("checked")){var d=moment(b.date()),e=moment(c.date());d.isSame(e)&&$.AssolCalendar.IsStartDay(d)&&c.date(e.hours(23).minute(59).seconds(59))}b.format(a);c.format(a)}};$.AssolCalendar.Init()});
