$(document).ready(function(){$.AssolServices={Init:function(){this.InitActions();this.InitDynamicData();this.InitTemplate()},InitActions:function(){$(document).on("click","#btnShow, #EmployeeFilter input:radio",this.ReloadServiceLists);$(document).on("click",".action-western-send",function(a){a.preventDefault();var b=$(a.target).closest("td").attr("id-western");bootbox.confirm('\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0444\u043b\u0430\u0433 "'+(IsLoveStory?"% \u041a\u043b\u0438-\u043a\u0438":
"\u0412\u044b\u0441\u043b\u0430\u043b\u0438")+'" \u0434\u043b\u044f \u0443\u0441\u043b\u0443\u0433\u0438?',function(c){c&&$.AssolServices.SendWesternService(b,$(a.target).prop("checked")?0:1)})});$(document).on("click",".action-western-per",function(a){a.preventDefault();var b=$(a.target).closest("td").attr("id-western");bootbox.confirm('\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0444\u043b\u0430\u0433 "% \u041f\u0435\u0440-\u043a\u0430" \u0434\u043b\u044f \u0443\u0441\u043b\u0443\u0433\u0438?',
function(c){c&&$.AssolServices.PerWesternService(b,$(a.target).prop("checked")?0:1)})});$(document).on("click",".action-western-done",function(a){var b=$(a.target).closest("td").attr("id-western");bootbox.confirm("\u041f\u043e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u043c\u0435\u0442\u043a\u0443 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u043d\u0430 \u0443\u0441\u043b\u0443\u0433\u0443?",function(a){a&&$.AssolServices.DoneService(b,"western")})});$(document).on("click",".action-meeting-done",
function(a){var b=$(a.target).closest("td").attr("id-meeting");bootbox.confirm("\u041f\u043e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u043c\u0435\u0442\u043a\u0443 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u043d\u0430 \u0443\u0441\u043b\u0443\u0433\u0443?",function(a){a&&$.AssolServices.DoneService(b,"meeting")})});$(document).on("click",".action-delivery-done",function(a){var b=$(a.target).closest("td").attr("id-delivery");bootbox.confirm("\u041f\u043e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u043c\u0435\u0442\u043a\u0443 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u043d\u0430 \u0443\u0441\u043b\u0443\u0433\u0443?",
function(a){a&&$.AssolServices.DoneService(b,"delivery")})});$(document).on("keyup",".employee-id-input",function(a){delay(function(){var b=$(a.target).val();$.AssolServices.FindUser(b,a.target.id,"employee")},500)});$(document).on("keyup",".user-id-input",function(a){delay(function(){var b=$(a.target).val();$.AssolServices.FindUser(b,a.target.id,"user")},500)});$(document).on("click",".action-append-customer",function(a){var b=$(a.target).attr("user-role");$("."+b+"-id-input").val($(a.target).text())})},
InitDynamicData:function(){this.ReloadServiceLists()},InitTemplate:function(){$("#westernTemplate").template("westernTemplate");$("#meetingTemplate").template("meetingTemplate");$("#deliveryTemplate").template("deliveryTemplate")},FindUser:function(a,b,c){var d="#"+b+"_tg";$(d).html("\u041f\u043e\u0438\u0441\u043a...");a?$.post(BaseUrl+"services/find",{user:a,role:c},function(a){a.status?a.records?($(d).html(""),a=a.records.map(function(a){return'<a href="javascript: void(0);" class="action-append-customer" user-role="'+
c+'" id-customer="'+a.id+'">'+a.name+"</a>"}),$(d).html(a.join("<br>")+"<br>")):$(d).html("\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445..."):(console.log(a.message),$(d).html("\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445..."))},"json"):$(d).html('<a href="javascript: void(0);" class="action-append-customer" id-customer="0">\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0424\u0418\u041e \u0438\u043b\u0438 ID</a>')},DoneService:function(a,b){$.post(BaseUrl+"services/"+b+"/done",
{id:a},function(){$.AssolServices.ReloadServiceLists()},"json")},SendWesternService:function(a,b){$.post(BaseUrl+"services/western/send",{id:a,isSend:b},function(){$.AssolServices.ReloadServiceLists()},"json")},PerWesternService:function(a,b){$.post(BaseUrl+"services/western/per",{id:a,isPer:b},function(){$.AssolServices.ReloadServiceLists()},"json")},FilterList:function(){var a={},b=$("#date-start").data("DateTimePicker");b&&(a.start=b.date().format("YYYY-MM-DD"));(b=$("#date-end").data("DateTimePicker"))&&
(a.end=b.date().format("YYYY-MM-DD"));b=$("#EmployeeFilter");0<b.length&&(a.employee=b.find("input:checked").val());return a},ReloadServiceLists:function(){var a=$.AssolServices.FilterList();$.AssolServices.ReloadWesternList(a);$.AssolServices.ReloadMeetingList(a);$.AssolServices.ReloadDeliveryList(a)},ReloadWesternList:function(a){this.ReloadData("#western-list","western","westernTemplate",a)},ReloadMeetingList:function(a){this.ReloadData("#meeting-list","meeting","meetingTemplate",a)},ReloadDeliveryList:function(a){this.ReloadData("#delivery-list",
"delivery","deliveryTemplate",a)},ReloadData:function(a,b,c,d){$(a).html("\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0434\u0430\u043d\u043d\u044b\u0445...");$.post(BaseUrl+"services/"+b+"/data",d||{},function(b){b.status?b.records&&($(a).empty(),$.tmpl(c,b.records).appendTo(a)):showErrorAlert(b.message)},"json")}};$.AssolServices.Init()});
